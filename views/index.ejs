<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard Penerbangan Nasional</title>
    <link rel="stylesheet" href="/style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0"></script>
</head>
<body>
    <div class="container">
        <h1>ashboard Statistik Penerbangan di Provinsi NTB</h1>

        <form action="/upload" method="POST" enctype="multipart/form-data">
            <input type="file" name="csvfile" accept=".csv" required>
            <button type="submit">Upload Data CSV</button>
        </form>

        <div class="summary">
            <p><strong>Total Pesawat:</strong> <%= totalPesawat %> unit</p>
        </div>

        <div class="chart-grid">
            <div class="chart-box">
                <h3>Grafik Jumlah Pesawat per Tahun (2017–2024)</h3>
                <canvas id="chartTahunan"></canvas>
            </div>

            <div class="chart-box">
                <h3>Jumlah Pesawat Berdasarkan Rute Penerbangan</h3>
                <canvas id="chartRute"></canvas>
            </div>

            <div class="chart-box">
                <h3>Persentase Aktivitas Pesawat (Datang vs Berangkat)</h3>
                <canvas id="chartAktivitas"></canvas>
            </div>
        </div>

        <script>
            const dataPerTahun = <%- JSON.stringify(dataPerTahun) %>;
            const dataRute = <%- JSON.stringify(dataRute) %>;
            const dataAktivitas = <%- JSON.stringify(dataAktivitas) %>;

            Chart.register(ChartDataLabels);

            new Chart(document.getElementById("chartTahunan"), {
                type: "line",
                data: {
                    labels: Object.keys(dataPerTahun),
                    datasets: [{
                        label: "Jumlah Pesawat per Tahun",
                        data: Object.values(dataPerTahun),
                        borderColor: "rgba(52, 152, 219, 0.9)",
                        backgroundColor: "rgba(52, 152, 219, 0.3)",
                        tension: 0.3,
                        fill: true,
                        pointRadius: 5,
                        pointHoverRadius: 7
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: { display: true, text: "Tren Penerbangan 2017–2024", font: { size: 16 } },
                        datalabels: {
                            color: "#2c3e50",
                            align: "top",
                            anchor: "end",
                            font: { weight: "bold" },
                            formatter: function(value) {
                                return value.toLocaleString();
                            }
                        }
                    },
                    scales: {
                        y: { beginAtZero: true, title: { display: true, text: "Jumlah Pesawat (unit)" } },
                        x: { title: { display: true, text: "Tahun" } }
                    }
                }
            });

            new Chart(document.getElementById("chartRute"), {
                type: "bar",
                data: {
                    labels: Object.keys(dataRute),
                    datasets: [{
                        label: "Jumlah Pesawat per Rute",
                        data: Object.values(dataRute),
                        backgroundColor: [
                            "rgba(46,204,113,0.6)",
                            "rgba(231,76,60,0.6)",
                            "rgba(241,196,15,0.6)",
                            "rgba(155,89,182,0.6)"
                        ],
                        borderColor: "rgba(0,0,0,0.1)",
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: { display: true, text: "Distribusi Penerbangan Berdasarkan Rute" },
                        legend: { display: false },
                        datalabels: {
                            color: "#2c3e50",
                            anchor: "end",
                            align: "top",
                            font: { weight: "bold" },
                            formatter: value => value.toLocaleString()
                        }
                    },
                    scales: {
                        y: { beginAtZero: true },
                        x: { ticks: { autoSkip: false, maxRotation: 45, minRotation: 0 } }
                    }
                }
            });

            new Chart(document.getElementById("chartAktivitas"), {
                type: "pie",
                data: {
                    labels: Object.keys(dataAktivitas),
                    datasets: [{
                        label: "Aktivitas Pesawat",
                        data: Object.values(dataAktivitas),
                        backgroundColor: [
                            "rgba(52, 152, 219, 0.7)",
                            "rgba(46, 204, 113, 0.7)",
                            "rgba(231, 76, 60, 0.7)"
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        title: { display: true, text: "Persentase Aktivitas Pesawat" },
                        legend: { position: "bottom" },
                        datalabels: {
                            color: "#fff",
                            font: { weight: "bold" },
                            formatter: (value, ctx) => {
                                const total = ctx.chart._metasets[0].total;
                                const percentage = ((value / total) * 100).toFixed(1) + "%";
                                return percentage;
                            }
                        }
                    }
                }
            });
        </script>
    </div>
</body>
</html>
